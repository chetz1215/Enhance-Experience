#!/sbin/sh 
 set_ver=122; set_sec=/data/system/users/0/settings_secure.xml; if [ -f "$set_sec" ]; then if [ ! -z "$(grep dialer_default_application $set_sec)" ]; then if [ -z "$(grep 'dialer_default_application" value="com.google.android.dialer' $set_sec)" ]; then entry=$(grep -o 'dialer_default_application" value=.*$' $set_sec); newentry='dialer_default_application" value="com.google.android.dialer" package="android" />\r'; sed -i "s;${entry};${newentry};" $set_sec; fi; else max=0; for i in $(grep -o 'id=.*$' $set_sec | cut -d\" -f2); do test $i -gt $max && max=$i; done; entry=' <setting id="'$((max + 1))'" name="dialer_default_application" value="com.google.android.dialer" package="android" />\r'; line=$((`grep -n "<settings version=" $set_sec | cut -d: -f1` + 1)); sed -i "${line}s;^;${entry}\n;" $set_sec; fi; else if [ ! -d /data/system/users/0 ]; then mkdir -p /data/system/users/0; chown -R system:system /data/system; chmod -R 775 /data/system; chmod 700 /data/system/users/0; fi; echo -e "<?xml version='1.0' encoding='UTF-8' standalone='yes' ?>\r" > $set_sec; echo -e '<settings version="'$set_ver'">\r' >> $set_sec; echo -e ' <setting id="1" name="dialer_default_application" value="com.google.android.dialer" package="android" />\r' >> $set_sec; echo -e '</settings>' >> $set_sec; fi; chown system:system $set_sec; chmod 600 $set_sec; 
